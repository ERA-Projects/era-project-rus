### Версия 2.120

#### Advanced Difficulties Mod:
- добавлена ​​совместимость между ADM и MNM. Теперь, когда опция "Рост существ за пределы 4т" активна, MNM будет показывать правильный размер стека в тексте подсказки и диалоговом изображении

#### Game Enhancement Mod:
- Исправление опыта существ у отрядов при переигровке битв: теперь используется более надежный способ получения указателей армии

#### WoG Scripts:
- Улучшения за Мифрил: улучшена совместимость между Mithril Enhancement (функция Monolith) и функцией GEM Monolith Locator.
- Изумрудная Башня: количество существ для жертвоприношения сделано модифицируемым


### Версия 2.119

#### Game Enhancement Mod:
- Исправлены неверные константы;

#### ERA Scripts:
- Исправлен скрипт "Захват мельниц и садов";


### Версия 2.118

>[!WARNING]
> Не обновляйте HD-mod, так как его новая версия конфликтует с некоторыми плагинами;

#### Game Enhancement Mod:
- Исправлена ​​ошибка, из-за которой в некоторых сценариях при воспроизведении боя возникали неполадки в данных об опыте существ (влияла на опцию «Метаморф»).

#### WoG Scripts:
- Death Chamber: Now the hostile spell casting before action is only triggered when it's a monster action (Walk/Defend/Walk and Attack/Shoot).

#### Other:
- прочие мелкие исправления;


### Версия 2.117

>[!NOTE]
> Мод 16 2-Ways Monoliths удален из сборки из-за отсутствия стабильности;

#### Advanced Difficulties Mod:
- Исправлены настройки банков существ.

#### Advanced Classes Mod:
- Теперь опция "Магические грибы" отключена, так как она конфликтует с несколькими функциями ACM
- Убрана "Антимагия" из случайного заклинания, выдаваемого при использовании ГМ Воскрешения, так как она препятствует дальнейшему использованию Воскрешения.
- Исправлены способности нейтральных командиров, не адаптированные ACM.
- Исправлено улучшенное Лечение, которое прерывает возможность использования Воскрешения на убитых юнитах (из-за изменения их ОЗ).

#### ERA Scripts:
- Третий класс: Теперь эта опция частично совместима с ACM. Включение этой опции и ACM позволяет выбирать из 3 навыков вместо 2 при повышении уровня героя.

#### Game Enhancement Mod:
- Панель здоровья: добавлена ​​возможность установить панель здоровья под меткой номера существа
- Исправлено странное взаимодействие при наличии дубликатов частей комбинации
- Исправлен текст плагинов GEM
- Исправлено определение версии игры с помощью скриптов;

#### WoG Scripts:
- Новые поля сражений: исправлены новые поля сражений, которые иногда не включались.
- Рост популяции нейтральных городов и банков существ: исправлен ежемесячный сброс охраны Банков Существ
- Неделя монстров: скрипт переписан и теперь с ним можно играть
- Рыболовный колодец: теперь событие "Тоннель" будет активироваться только на случайных картах (так как это потенциально нарушает совместимость с некоторыми пользовательскими картами)
- Улучшения мифрила: исправлена ​​ошибка !!MN:R (не используйте здесь краткую форму координат, например MN4, вместо этого используйте MNv4/v5/v6)
- Артиллерия: исправлена ​​сторона цели автоматического заклинания при применении артефактами после предотвращающего выстрела;

#### WoG:
- Исправлен плагин поддержки нескольких языков.


### Версия 2.116

#### Advanced Difficulties Mod:
- отформатированы некоторые текстовые строки в файле json
- Командиры в банках существ больше не будут получать способности и немного уменьшат свое масштабирование в начале игры
- удалены лишние шрифты

#### Advanced Classes Mod:
- исправлено отображение текста в диалогах

#### Game Enhancement Mod:
- реорганизация тексты
- добавлена ​​полоска здоровья в бою
- добавлена прокрутка карты на СКМ и ПКМ
- добавлено удаление героев города
- добавлено подтверждение команд с помощью пробела в диалогах
- удалено "creature stats texts.era"
- исправлена ​​потеря строк опыта при переигровке боя

#### WoG Scripts:
- Метаморфы: Исправлена ​​возможность трансформации при недостаточном пространстве.
- Воссозданная функция GetRandomMonster (используется в Неделе Монстров/Метаморфах)
- добавлена ​​поддержка gosolo для скрипта разведки


### Версия 2.115

#### WOG:
- Удалено отладочное сообщение, возникающие при открытии диалогов


### Версия 2.114

#### Game Enhancement Mod:
- Исправлена ​​путаница в статистике существ с опытом стека после повтора битвы, когда стек был убит флагом Summoned. Это исправило статистику Metamorphs и, возможно, некоторые сторонние скрипты.

#### WOG:
- переписаны некоторые плагины для повышения стабильности игры

#### WoG Graphics Fix Lite:
- Fixed WM II catapult small icon

#### WoG Scripts:
- добавлена поддержка плагина генерации ВоГ-объектов на случайных картах (плагин пока что доступен в VIP-канале)
- Хижины командиров ведьм: добавлена возможность отказаться от предложенного навыка

#### Other:
- добавлен исходный код ERA
- обновлены и добавлены заголовочники для создания плагинов для с использованием ERA API


### Версия 2.113

#### Advanced Classes Mod:
- исправлена ​​ошибка ERM во время лечения в бою 

#### ERA Scripts:
- Удалена опция "Засады Бандитов", так как он очень похожа на "Атаку воров".
- Удалены erm-файлы с неиспользуемыми функциями

#### WoG Scripts:
- теперь срабатывает только со второго дня (так же, как ежедневные события из оригинальной игры)
	- Хозява жизни
	- герои создают магический ландшафт каждый день
	- улучшенные монстры героя 7-го уровня становятся монстрами 8-го уровня


### Версия 2.112

#### Advanced Classes Mod:
- Теперь Огненные Маги и союзники будут по-прежнему невосприимчивы к собственному Огненному Шару с представленной Сферой Уязвимости.
- Теперь Дипломатия не может привлекать существ, которые не могут быть созданы на карте (необходимо заранее установить MA:H=0).

#### Game Enhancement Mod:
- hotfix


### Версия 2.111

#### Advanced Classes Mod:
- В многопользовательских играх текст способностей из наборов "Усадьба"/"Природный Целитель"/"Тайный" не отображается для удаленного игрока.
- Исправлена проблема в многопользовательской игре, когда во время боя можно было выбрать заклинание вражеского командира (классы Архимаг/Хранитель), что приводило к рассинхронизации.
- Теперь немного сложнее получить высокие значения характеристик для заклинаний "Молитва" и "Благословение".
- Различные исправления для многопользовательских игр.
- Заклинание "Рассеивание" теперь принадлежит школе Воздуха, а "Маскировка" перемещено в школу Воды.
- Исправлено сообщение о бонусе набора "Разведка" перед боем.
- Изменено описание артефакта "Мощь Отца Драконов".
- Знак Мужества больше не дает иммунитет к ментальным заклинаниям для всех войск.
- Заклинания класса командира "Хранитель" теперь правильно масштабируются в зависимости от модификатора заклинания.
- Все заклинания, накладываемые командирами, теперь имеют 50% шанс дать +1 к числу убитых.
- Исправлена совместимость с ERA 3.9.15 (хук "Поместье").
- Отключена Экономика (опция ES), так как она вызывает проблемы с множественным текстом описания и совместимостью специализаций.
- Оптимизированы триггеры HL (учтите, что они выполняются для героев с высоким уровнем по умолчанию. Здесь мы используем i^acm_isGameStarted^, чтобы пропустить процесс HL до начала игры).
- Исправлен текст специалиста Мутаре.
- Немного уменьшено масштабирование урона заклинания "Огненный Щит".
- Исправлена ошибка с нулевым перемещением командира класса "Охотник".
- Предотвращено уменьшение количества существ в отряде лечащего существа, если у него есть BM:B>BM:N.
- Щит Огра имеет небольшой шанс блокировать 50% урона.
- Деревянный щит Гнома дает бонус к жизни войскам 1 и 2 уровней.
- Щит Гнолла накладывает эффект "Зеркало магии" в первом раунде боя.
- Масштабирование артефактов командира уменьшено вдвое.
- Артефакты командира больше не теряют бонусы при снятии.
- Навык атаки командира (от Базового до Грандмастера) теперь масштабируется от 5 до 25, как и защита.

#### ERA Scripts:
- Исправлено зависание игры при отображении достижений
- добавлена совместимость с модом WoG Graphics Fix

#### Game Enhancement Mod:
- Обновление главного плагина до версии 1.7:
	- Изменён курсор при наведении на номера версий в главном меню;
	- Добавлена возможность открыть список изменений игровой сборки (клик на установленной версии сборки)
	- Добавлена возможность открыть список изменений движка ERA (клик на версии ERA)
	- Напоминаю о возможности перейти на веб-сайт с последней версией (клик на последней версии сборки)
	
#### WoG Scripts:
- Улучшение замка: Исправлены данные о приросте, отображаемые в диалоговом окне, вызываемом правой кнопкой мыши по значкам существ в городах.
- Случайный герой: Исправлен случайный герой, который становился доступным для всех игроков после битвы (если он был забанен на карте).


### Версия 2.110

#### Advanced Classes Mod:
- Отключено удаление теоретического боя ИИ против ИИ
- Теперь сила Мастерской/Грандмастерской Некромантии составляет 20%/25% (было 17%/20%)
- Альтернативная Некромантия:
	- Теперь выбор существа для подъема для альтернативной некромантии будет сбрасываться, когда герой возрождается в тавернах.
	- Теперь сила Некромантии для подъема пользовательского существа рассчитывается на основе текущих значений:
		- Ходячие мертвецы: 80% от исходного значения
		- Призраки: 55% от исходного значения
		- Вампиры: 30% от исходного значения
		- Личи: 25% от исходного значения
		- Черные Рыцари: 15% от исходного значения

#### ERA Scripts:
- Смертные Герои: исправлена ​​ошибка, из-за которой значок специальности иногда не сбрасывался, когда герой получал новую специальность.

#### Game Enhancement Mod:
- добавлен выбор шрифта добавляемых текстовых элементов главного меню;
- добавлен вопрос перед открытием сайта с последней версией сборки на GitHub;

#### Other:
- Добавлен вьетнамский язык в диалог выбора языка;
- Некоторые моды получили иконки;
- Добавлены кампании Heroes Chronicles;


### Версия 2.109

## HD Mod:
- По умолчанию теперь активированы следующие твики:
	- `Fix.Crit.MapsOver5000` - исправляет вылет при огромном количестве карт;
	
#### ERA Scripts:
- Смертные Герои: исправлена опечатка;

#### Game Enhancement Mod:
- Добавлено исправление некорректного расчёта бонуса игнорирования защиты;


### Версия 2.108

#### ERA Scripts:
- Смертные Герои: исправлена опечатка;


### Версия 2.107

## HD Mod:
- По умолчанию теперь активированы следующие твики:
	- `Misc.TournamentSaver` - ежедневно создаёт уникальные сохранения для каждой игры;
	- `Misc.RenameRandMap` - создаёт уникальное имя для каждой карты, созданной Генератором Случайных Карт;
	- `UI.Ext.TownMgr.AvailableInsteadGrowth` - В окне города отображает количество доступных для найма существ, а не прирост;
	- `UI.Tavern.InviteHero` - позволяет выбрать следующего нанимаемого героя после покупки текущего;
	- `UI.Ext.AdvMgr` - поддерживает расширенную подсказку в строке состояния карты приключений;

#### Advanced Classes Mod:
- Альтернативная некромантия теперь активируется щелчком левой кнопки мыши по значку некромантии (ранее — щелчком правой кнопкой мыши).

#### ERA ERM Framework:
- добавлен адрес массива стуктур Командиров;
- добавлен адрес SWAP_MANAGER (Менеджер встречи героев);

#### ERA Scripts:
- Городские сокровища: исправлена ​​ошибка, из-за которой иногда было невозможно обокрасть Красного игрока.
- Ночная разведка: оптимизирован диалог для проверки принадлежащих героям ассасинов.
	- Смертные герои:
	- Предотвращение генерации одинаковых специальностей при спаме битв в одном и том же месте.
	- Сброс NPC теперь осуществляется функцией WoG, более высокая совместимость с опцией "Усиленные командиры"

#### TrainerX:
- Исправлена ​​невозможность изменить уровень героев, не принадлежащих текущему игроку.

### WoG Scripts:
- Исправлено описание вогификации в меню вог-опций;
- ## Опция "Неделя монстров" временно отключена;
- Стандартизировано взаимодействие вторичных навыков (Поместье II, Разведка I/III). Теперь они активируются щелчком левой кнопкой мыши по иконкам вторичных навыков на экране героя. Их нельзя активировать, если это не ход игрока/герой не принадлежит игроку.
- При включении Разведки I и Разведки III диалог настройки Разведки I активировался щелчком правой кнопкой мыши по иконке Разведки. (так как диалог левой кнопки мыши занят Разведкой III).
- Освобождены z250-z265, z770-z786 из скрипта Разведка III. Теперь их можно использовать свободно.
- Разведка III: Базовая разведка больше не может красть ресурсы и заклинания (для использования необходимо перейти на продвинутый уровень). Исправлено неправильное отображение основных навыков героя в городе, в который проникли.
- Артиллерия: ограничено количество баллист при превентивном выстреле до 1;
- Усиленные Командиры: небольшая оптимизация кода, исправление сброса заклинания Астрального Духа;

#### Other:
- Добавлен хук (xxx_OnResetHero) для работы с переменными героя (или глобальными переменными героя). Это должно помочь сбросить выбор вторичных навыков/артефактов, когда герой уволен/побежден и возрождается в тавернах.
- добавлены пропущенные данные кампаний Клинка Армагеддона


### Версия 2.106

#### Advanced Classes Mod:
- Топор Кентавра теперь дает +5% к шансу физического крита
- Трейнер заклинаний призыва теперь дает процентный бонус (слабее в начале игры, сильнее в конце)
- Шлем Единорога, Подвода с Боеприпасами ( и её улучшения) обеспечивают большее восстановление очков заклинаний после боя
- Восполнение очков маны (улучшение Подводы с Боеприпасами) теперь требует вторичный навык "Искусство Войны" (Тактика) вместо Обучения (делает его более доступным для Воинов, так как им может быть сложно иметь достаточно Маны). Улучшение "Overheal" теперь требует навык "Обучение" вместо Искусства Войны (Тактики).
- Дубина Короля Огров: исправлена ​​неработающая способность оглушения
- Способность "Пацифист" больше не будет уменьшать урон от низкоуровневых юнитов на 50% (спасибо Diozia)
- Исправлена ​​некорректная работа Дипломатии
- Перебалансированы эффекты способности "Калека". Минимальная скорость существ составляет 3 вместо 2 (те же характеристики, что и у крестьян).

#### Advanced Difficulties Mod:
- Исправлено: дополнительные способности не будут накапливаться при переигровки битв (спасибо TheInvisible1966)

#### ERA Scripts:
- Смертные Герои: Теперь специализация "Аура Проклятия" больше не дает вам скрытую специализацию заклинания. Улучшен текст журнала битвы: теперь он более понятен.
- Удалены лишние функции;

#### Game Enhancement Mod:
- Добавлено взаимодействие с Водоворотом Маны в стиле HotA: Водоворот Маны теперь активируется вручную и может быть использован только гостевым героем. Кроме того, невозможно использовать Водоворот Маны в городах союзников.

#### WoG Graphics Fix Lite:
- Обновление мода до версии 2.18.0;

#### WoG Scripts:
- Пещера приключений: теперь способности, полученные от отшельников, можно использовать в сетевых битвах.

#### Other:
- исправления некоторых файлов локализации;


### Версия 2.105

#### ERA Scripts:
- улучшены специалисты по существам: изменен хук и оптимизирован скрипт;
- Скелеты с артефактами: убрана анимация при быстрой битве;

#### WoG Scripts:
- Артиллерия: исправлен вылет при атаке городов с башнями;


### Версия 2.104

#### Advanced Classes Mod:
- Исправлено отображение сообщения о грабеже, когда город игрока-человека захвачен ИИ.

#### ERA ERM Framework:
- Добавлена ​​инициализация боевых переменных в триггере OnSetupBattlefield;

#### ERA Scripts:
- Теперь опция "артефакты рюкзака" полностью совместима с ACM (снова). Включение этой опции с помощью ACM позволяет артефактам очков движения давать очки передвижения из рюкзака.

#### Game Enhancement Mod:
- Отключение кнопок и диалоги быстрого боя на карте обучения (поскольку в обучении отключена вся функция быстрого боя).

#### WoG Scripts:
- В скрипт "Хозяева Жизни" добавлена ​​функция, позволяющая внешним скриптам управлять существами.
- Рефакторинг скриптов бонусов для нейтральных юнитов, повышение производительности и устранение потенциальной проблемы пересечения переменных.

### Версия 2.103

#### Advanced Classes Mod:
- Исправлена ​​возможность колдовать "Забывчивость" на тех, кто не стреляет.

#### WoG:
- Исправлен вылет при попытке создания случайных карт;
- Добавлены картинки для кампаний "Хроник";


### Версия 2.102

#### ERA:
	- ВНИМАНИЕ! примеры использования всех нововведений находятся в файле "/Help/Era manual/era iii Changelog.txt";

- ## обновление ядра ERA.dll до версии 3.9.15:
- Обновлен плагин erm_hooker.era до версии 3.0:
 — Переключен на современный API исправлений из era.dll.
 - Реализована защита от перекрытия патчей.
 - Реализована защита от восстановления патчей, если пропатченный код был изменен сторонним кодом.
 - Улучшен код исправления моста.
 - Добавлен отчет о версии (ПКМ по кредитам в меню игры).
 - Файл отчета об исправлениях (Debug/Era/ermooks.txt) теперь использует удобочитаемые имена функций ERM вместо числовых идентификаторов.
 - Добавлена ​​поддержка библиотек сценариев ERM. Скрипты, расположенные в каталоге Data/s/lib, считаются скриптами библиотеки. Они загружаются перед другими глобальными скриптами и перед всеми скриптами карты (как внутренними, так и внешними). Такие скрипты необходимо грамотно писать, использовать только именованные переменные и функции с префиксами. Они не должны влиять на игровой процесс, интерфейс или другие скрипты. Их следует рассматривать как вызываемую коллекцию функций вместе со связанными константами и структурами данных.
- Скрипты Era Erm Framework перемещены в "Data/s/lib" и теперь могут использоваться в картах, даже в картах, отключив глобальные сценарии ERM.
- Исправлена ​​команда "DL:H". Любая строка принимается как подсказка. Подсказка копируется во внутреннюю папку диалога и автоматически освобождается при закрытии диалога. Больше нет необходимости использовать глобальные z-переменные для пользовательских подсказок диалога. Подсказки больше не интерполируются во время показа.
- Изменена команда "IF:L", позволяющая использовать любую строку в качестве аргумента и автоматически экранировать символ "%". Раньше строки с "%" приводили к некорректным результатам или даже к сбоям.
- Изменены команды "HE:B0", "HE:B1", "HE:B3", чтобы использовать любую строку в качестве аргумента.
- Переписаны функции WoG "ApplyString" и "NewMesMan", позволяющие использовать любую строку в нескольких командах ERM (CA, LE, GE и т. д.):
  - Отключен синтаксис установки сообщения о событии на сообщение о событии с заданным идентификатором (например, "GE:M30" для события с идентификатором 30).
  - Устаревший синтаксис использования -1 вместо пустой строки.
- Расширенный синтаксис SN:K(str)/(ind)/[?](strchar или char code). Если результатом является целочисленная переменная, вместо нее возвращается символьный код.
- Расширение команды "VR:F  4-м параметром:
	- Если указано (defaultValue) и переменная не соответствует диапазону (minValue)..(maxValue), ей будет присвоено значение (defaultValue):
	```
	!!VR(intVar):F(minValue)/(maxValue)/(showErrors)/(defaultValue);
	```
- Повышена стабильность выполнения динамических команд ERM с использованием API ExecErmCmd. Добавлена ​​поддержка всех переменных ERM 2 в параметрах команды.
- Расширен буфер быстрой памяти ERM для строковых литералов и строковых аргументов в командах и триггерах ERM с 1 МБ до 3 МБ.
- Добавлена ​​возможность увеличить размер буфера для скомпилированных скриптов erm с помощью настройки heroes3.ini. Значение по умолчанию — 128 МБ. Для одной команды ERM требуется ~0,5 КБ:
  - CompiledErmBufSize = 134217728; максимальный размер буфера для скомпилированных erm-скриптов (не влияет на динамическую компиляцию на лету с использованием PersistErmCmd или ExecErmCmd)
- Отключен трекинг ERM для кода обработки мыши и клавиатуры Era Erm Framework.
- Улучшено форматирование отчета об отслеживании ERM.
- Добавлено новое событие OnBeforeLoadGame для плагинов. Это происходит сразу после выхода из старой игры и перед загрузкой новой игры.
- В файл heroes3.ini добавлена ​​новая опция "Debug.CopySavegameOnCrash". Эта опция включена по умолчанию и включает копирование последнего использованного сохранения игры в каталог отладки при сбое, что может быть полезно для отладки вылетов/ошибок.
- Несколько сообщений из кода перенесены в era.json для дальнейшей локализации:
	- era.no_memory_for_erm_optimization;
	- era.game_crash_message;
- Переработаны и обновлены файлы Era SDK в "Tools/Era/SDK". Для C++ используйте "era.h" и "era.cpp". Для Delphi используйте "era.pas".

- В Era Erm Framework добавлены следующие функции:
    - ```
        !?FU(Interpolate);
        ; Interpolates ERM variables inside given string (%v1, etc). Can be used for nested translation strings like %T(...) is json.
        !#VA(strPtr:x);    Source string.
        !#VA(resultPtr:x); OUT. Result string.
    
        Example:
    
        !!VRi^edu_age^:S33;
        !!VRs^edu_name^:S^Xeon^;
        !!VR(templateStr:z):S^%%s(edu_name) is %%i(edu_age) years old^;
        !!IF:M(templateStr); displays "%s(edu_name) is %i(edu_age) years old"
        !!FU(Interpolate):P(templateStr)/?(interpolatedStr:z);
        !!IF:M(interpolatedStr); displays "Xeon is 33 years old"
        ```
    - ```
        !?FU(Trim);
        ; Trims #0..#32 characters (space and control characters) from both sides of the string.
        !#VA(strPtr:x);    Source string.
        !#VA(resultPtr:x); OUT. Result string.

        Example:

        !!VR(text:z):S^    Hello World    ^;
        !!FU(Trim):P(text)/?(text);
        !!IF:M^%(text)^; displays "Hello World" without leading and trailing spaces
        ```
    - ```
        !?FU(StrPos);
        ; Finds the first occurance of needle string in the haystack string. Returns offset from string start or -1 for faulure
        !#VA(haystackPtr:x); String to search in
        !#VA(needlePtr:x);   String to seacrh for
        !#VA(result:x);      Result offset in the haystack string or -1.
        !#VA(offset:x);      Zero-based offset in haystack string to start search from. Default: 0.

        Example:

        !!VR(text:z):S^Hello World^;
        !!FU(StrPos):P(text)/^World^/?(substrPos:y);
        !!IF:M^%(substrPos)^; displays "6"
        ```
    - ```
        !?FU(StrReplace);
        ; Replaces all occurencies of Pattern string in the Source string with Replacement string. Returns final string.
        ; Can be used inside triggers only.
        !#VA(sourcePtr:x);      Original string to perform replacements in
        !#VA(patternPtr:x);     What string to replace
        !#VA(replacementPtr:x); Replacement string
        !#VA(result:x);         Result string index

        Example:
    
        !!VR(text:z):S^You should cast the spell. Spell casting increases your intelligence^;
        !!FU(StrReplace):P(text)/^cast^/^learn^/?(text);
        !!IF:M^%(text)^; You should learn the spell. Spell learning increases your intelligence
        ```
- В Era Erm Framework добавлены следующие константы:
	- CHAT_EVENT_TYPE_XXX для подтипа события "OnChat"
	- CHAT_EVENT_RESULT_XXX для результата события "OnChat"
- В era.dll добавлены следующие экспортированные функции:

  (* Компилирует одну команду ERM без префикса !! и условий и сохраняет скомпилированный код в постоянной памяти.
     Возвращает ненулевой непрозрачный указатель в случае успеха и ноль в случае неудачи. Завершающая точка с запятой необязательна *)
  function PersistErmCmd (CmdStr: pchar): {n} pointer; stdcall;

  (* Выполняет ранее скомпилированную и сохраненную команду ERM. Для компиляции используйте PersistErmCmd API *)
  procedure ExecPersistedErmCmd (PersistedCmd: pointer); stdcall;

  (* Переводит заданную строку. Возвращает статический адрес преобразованной строки, который никогда не будет освобожден *)
  function trStatic (const Key: pchar): pchar; stdcall;

  (* Преобразует заданную строку. Передает параметры как пары (ключ, значение). Возвращает временный адрес строки, который необходимо немедленно скопировать в безопасное место *)
  function trTemp (const Key: pchar; Params: pointer to array of pchar; LastParamIndex: integer): pchar; stdcall;

  (* Возвращает удобочитаемую строку для идентификатора события ERM. Обычно это удобочитаемое имя триггера ERM или имя функции ERM.
     Вызывающий ДОЛЖЕН освободить возвращенный блок памяти, используя MemFree из era.dll *)
  function GetTriggerReadableName (EventId: integer): {O} pchar; stdcall;

  (* Устанавливает новый хук по указанному адресу. Возвращает указатель на мост с исходным кодом. При необходимости укажите адрес указателя, на который будет записан указатель структуры примененного патча.
     Это позволит позже откатить патч.
     Функция-обработчик должна использовать соглашение stdcall. Он получает указатель контекста ловушки и должен возвращать ненулевое значение, чтобы выполнить перезаписанный код. *)
  function HookCode (Addr: pointer; HandlerFunc: THookHandler; {n} AppliedPatch: ppointer): pointer; stdcall;

  type
    PHookContext = ^THookContext;
    THookContext = packed record
      EDI, ESI, EBP, ESP, EBX, EDX, ECX, EAX: integer;
      RetAddr:                                pointer;
    end;

    THookHandler = function (Context: PHookContext): LONGBOOL; stdcall;


  (* Рассчитывает количество байтов, которые будут перезаписаны при размещении крючка *)
  function CalcHookPatchSize (Addr: pointer): integer; stdcall;

  (*Патч откатится и внутренняя память и освободится. Больше не используйте*)
  procedure RollbackAppliedPatch ({O} AppliedPatch: pointer); stdcall;

  (* Освобождает структуру примененного патча. Используйте его, если вы больше не планируете откатывать его *)
  procedure FreeAppliedPatch ({O} AppliedPatch: pointer); stdcall;

- Изменены некоторые экспортированные сигнатуры функций. Многие из них теперь используют тип TInt32Bool (32 бита 0 или 1) вместо логического значения для лучшей совместимости с ERM:

      type
        TIsCommanderIdFunc       = function (MonId: integer): TInt32Bool stdcall;
        TIsElixirOfLifeStackFunc = function (Stack: Heroes.PBattleStack): TInt32Bool stdcall;
    
      function IsCommanderId (MonId: integer): TInt32Bool; stdcall;
      function SetIsCommanderIdFunc (NewImpl: TIsCommanderIdFunc): {n} TIsCommanderIdFunc; stdcall;
      function IsElixirOfLifeStack (Stack: Heroes.PBattleStack): TInt32Bool; stdcall;
      function SetIsElixirOfLifeStackFunc (NewImpl: TIsElixirOfLifeStackFunc): {n} TIsElixirOfLifeStackFunc; stdcall;
    
      (* Returns 32-character unique key for current game process. The ID will be unique between multiple game runs. *)
      procedure GetProcessGuid: static_pchar; stdcall;

- Повышена производительность функции "Substr" из Era Erm Framework.
- Небезопасные хуки Era с указанными вручную размерами хуков заменены на полностью автоматические хуки с расчетом длины хука с использованием встроенного механизма дизассемблера.
- Исправлена ​​ошибка: события "OnWinGame" и "OnLoseGame" не выполнялись после "OnGameLeave", поскольку к этому моменту движок ERM был отключен. Теперь "OnWinGame" и "OnLoseGame" происходят непосредственно перед "OnGameLeave".
- Исправлена ​​ошибка ERM. При доступе к элементу локального массива по индексу переменной отсутствовала поддержка отложенных вычислений. Такие конструкции, как "!!if&v1<>v1/(array[hugeValueVar])", используются для создания предупреждений во время выполнения. На данный момент индекс недопустимого элемента изменен на 0, что приводит к ошибке времени выполнения только в случае реального доступа к элементу.
- Исправлена ошибка в функции IsCommanderId, приводившая к вылету.
- Исправлена ​​ошибка в игре: ввод текста в строке чата приводил к фантомному нажатию кнопки мыши в чате.
- Исправлен сбой, возникающий при отключении опции "Debug.TrackErm". Ошибка появилась в версии 3.9.14.
- Исправлена ​​ошибка: контекст памяти ERM терялся в исключениях из-за новой реализации быстрого выхода в главное меню.
- Исправлено полное обнаружение битвы ИИ в WoG. Таймер автозакрытия диалога больше не сравнивается с 0. Чит "gosolo" снова работает в боях без ошибок ERM.
- Устаревшие экспортированные функции "ApiHook" и "Hook". "Hook" отобразит сообщение об ошибке, а ApiHook сохраняется только для устаревших версий. Вместо этого используйте HookCode или API patcher_x86 напрямую.
- Исправлена ​​старая ошибка обработки событий. Запуск события ERM с отключенным ERM также привел к тому, что глобальное событие не было создано. Например, Era и плагины не могли обработать событие OnSavegameRead, если ERM был отключен в момент загрузки сохранения игры.

#### Advanced Classes Mod:
- Теперь иммунитет к заклинаниям больше не действует на собственные войска.
- исправлено самоисцеление палатки первой помощи при щелчке правой кнопкой мыши в бою.
- Исправлены хуки ACM Before Attack/After Attack.
- Исправлено отсутствие предоставления позиции в отряде для подсказок о боевых машинах.
- Исправлен Свиток призыва, не работавший при экипировке более 1 свитка;
- Исправлен Огненный Щит:
  1. Теперь мы проверяем, был ли целевой стек применен героем "Огненный щит", вместо того, чтобы проверять, применил ли герой "Огненный щит" к какому-либо из стека, чтобы определить, следует ли призвать огненного элементаля.
  2. Удалены все использование BG в MF1 для Fire Shield, избегая проблем с совместимостью.
  3. исправлен расчет урона Огненного Щита.

- Способность "Блокировать" у Торосара теперь ограничена 100% вероятностью/95% блокировкой урона.
- Исправлены описания специалистов Командира.
- Предотвращено уменьшение количества лечимых существ, если у него есть BM:B>BM:N.
- Исправлена ​​ошибка, из-за которой Сапоги Противодействия не обновляли экран после получения очков движения.
- исправлен текст специалиста Мутаре
- немного уменьшено масштабирование урона от Огненного щита.
- исправлена ​​ошибка с нулевым движением командира класса Охотник.
- Знак отваги больше не дает иммунитет к разуму.
- Мощь Отца Драконов - изменено описание, чтобы показать, что она не защищает от "Снятия Заклинаний".
- Исправлен счетчик убийств командира при переигровке боя.
- Добавлена подсказка в журнал боя для естественного сопротивления (поскольку многие игроки сочли эту способность запутанной)
- Заклинания командирского класса "Страж" теперь имеют правильное масштабирование в зависимости от модификатора заклинания.
- все заклинания, произнесенные командирами, теперь имеют 50% шанс дать +1 к количеству убийств.

#### Advanced Difficulties Mod:
- исправление неправильного расчета боевой награды с настройками банков существ (спасибо Maximo)
- Настройки сложности банков существ немного уменьшили бонус ОЗ командира в неделю на более низких уровнях сложности.
- Исправлена ​​возможность получения боевой награды при убийстве атакующего героя.
- Исправлена ​​возможность давать ИИ опыт, если этого не должно быть (достижение максимального уровня или уровень 6424).

#### Easy Cheats:
- Выпущен новый мод "Easy Cheats" с действительно простыми для ввода и запоминания читами и встроенной консолью ERM. Для получения подробной информации введите "help" в чате (Не забудьте включить его в Менеджере Модов).

#### ERA Scripts:
- Халфинги-Уклонисты: исправлен диапазон урона, от которого нужно уклоняться.
- Батраки:
  - Перемещено положение кнопки "Пеоны" на 5 пикселей вправо, чтобы не закрывать число доходов.
  - Теперь можно отправлять на "работу" войска героя-посетителя, если в гарнизоне нет войска
- Банк Лепрекона: добавлено обновление экрана после заёма в банке.
- Ночная разведка: исправлено изображение Ассасина в диалоге.

#### Game Enhancement Mod:
- Хижины Провидцев: части комбо-артефактов больше не будут выбраны в качестве квестового предмета в Хижинах Провидцев.
- Исправлено отсутствие срабатывания условия победы после захвата всех 7 башен Грифона в сценарии "Да здравствует королева" — сценарий "Утес Грифона".
- Исправлен вылет в бою без лодки на море - возникает из-за отсутствия фона поля боя, вызванного событиями на пользовательских картах, когда герой движется по морю с помощью полета/по воде.
- Исправлена ​​проходимость после посещения тюрем с плагином "game bug fixes extended.dll".

#### HD mod:
- Обновлен до версии 5.5 R6;

#### TrainerX:
- Для работы TrainerX требуется ERA 3.9.15.
- Теперь TrainerX можно использовать на любой карте, включая карты Valery, предотвращающие WoGификации.
- Добавлен Ctrl+ЛКМ по портрету героя в главном интерфейсе трейнера, чтобы центрировать камеру по местоположению героя.

#### WoG Scripts:
- Исправлена ​​ошибка при нажатии на сумму боевого духа при активном моде 10SSkills;
- Нейтральный опыт стека: исправлено взаимодействие с опцией опыта стека. Можно включить опыт нейтрального стека, не включая опыт другого стека.
- Метаморфы: исправлена ​​неверные параметры метаморфа после того, как он трансформировался и получил опыт.
- Улучшения за Мифрил: исправлен эффект улучшения шахт, который длится всю игру (согласно описанию должно составлять 1 неделю)
- Небольшая настройка Изумрудной Башни (не менять боевую ценность при улучшении)

#### Other:
- Несколько небольших корректировок скриптов.
- В список objects.txt добавлены существа-командиры для поддержки их размещения на карте;
- небольшая реорганизация файлов;
- добавлены следующие шаблоны для создания случайных карт в набор hd mod:
	- 8xm8a;
	- 8xm8;
	- 13th Region;
	- Battle Arena;
	- Blood Star;
	- Great Sands;
	- Magic of Decateron;
	- Pentagram;
	- Penteract;
	- Tesseract;


### Версия 2.101

#### ERA:
- Исправлена ​​старая ошибка обработки событий. Запуск события ERM с отключенным ERM также привел к тому, что глобальное событие не было создано. Например, Era и плагины не могли обработать событие OnSavegameRead, если ERM был отключен в момент загрузки сохранения игры.

#### Game Enhancement Mod:
- исправлены неработающие чит-коды;

#### Random Wallpaper Mod:
- удалены лишние файлы;

#### WoG Graphics Fix Lite:
- Обновление мода до версии 2.18.0;

### Версия 2.100

#### ERA:
	- ВНИМАНИЕ! примеры использования всех нововведений находятся в файле /Help/Era manual/era iii Changelog.txt;

- обновление ядра ERA.dll до версии 3.9.14:
	- добавлена поддержка захвата скриншотов:
		-  Добавлена поддержка захвата игровых скриншотов в форматах png/jpg. В era.dll была экспортирована следующая функция:

  			(*
    		Захватывает скриншот и сохраняет его в виде файла. Формат определяется автоматически по расширению. Поддерживаются следующие расширения: 'jpeg', 'jpg', 'png'. По умолчанию также захватывается курсор в игре. Возвращает флаг успеха.

    		'Quality' используется для указания качества сохранения jpeg (0..100).
    		'Flags'   - битовая маска функциональных флагов.

      		TS_FLAG_HIDE_CURSOR = 1; // Скрыть курсор
  			*)
  		- function TakeScreenshot (FilePath: pchar; Quality: integer; Flags: integer): TDwordBool; stdcall;
		- В heroes3.ini добавлена новая опция "Debug.CaptureScreenshotOnCrash". Опция позволяет захватить скриншот при сбое и сохранить его в "Debug/Era/screenshot.jpg".
	- улучшена стабильность выполнения ERM:
		- Добавлено автоматическое сброс отслеживания ERM и восстановление настроек при запуске или загрузке игры.
		- Реализована автоматическая очистка директории "Debug/Era" перед генерацией файлов отладки при сбое.
		
	- улучшены средства отладки:
		- Добавлено API времени выполнения для контроля за отслеживанием ERM. Оно может быть использовано для исключения хорошо протестированной библиотеки из окончательного лога отслеживания ERM или для отслеживания только определенных блоков кода:
			- В heroes3.ini добавлена новая опция "Debug.AllowRuntimeErmTrackingControl". Опция включает или отключает контроль времени выполнения за отслеживанием ERM. По умолчанию она включена и должна быть отключена в случае сложного отслеживания ошибок, когда нельзя доверять никакому коду.
			- В era.dll были экспортированы следующие функции:
				- procedure DisableErmTracking; stdcall; // Приостанавливает отслеживание ERM. Вся ранее отслеженная информация сохраняется.
				- procedure EnableErmTracking; stdcall; // Возобновляет отслеживание ERM.
				- procedure RestoreErmTracking; stdcall; // Устанавливает отслеживание ERM в значение, указанное в heroes3.ini (используемое до манипуляций во время выполнения).
				- procedure ResetErmTracking; stdcall; // Очищает все ранее записанные треки.

	- улучшена стабильность сетевой игры:
		- ### Предупреждение. Использование "OnGameEnter" для ERM хуков в сетевых играх не работает в Era < 3.9.14.

		Добавлена поддержка событий "OnGameEnter" и "OnGameLeave" в сетевых играх. Ранее передача сохраненной игры и загрузка на удаленной стороне вызывали "OnAfterSavegameLoad", но не "OnGameLeave" + "OnGameEnter". Поэтому использование плагина erm_hooker с событием "OnGameEnter" приводило к сбросу хуков после первого конца хода.
		  В сетевых играх последовательность событий после конца хода на удаленной стороне следующая:
		  
		    "OnGameLeave"     - здесь мы восстанавливаем патчи UN:C и снимаем хуки erm_hooker
		    "OnSavegameRead"  - чтение переданного сохранения
		    "OnAfterLoadGame" - полностью загруженное переданное сохранение
		    "OnGameEnter"     - установка патчей UN:C и ERM хуков снова

	- прочее:
		- Обновлен плагин erm_hooker.era и карта отладки (map-файл)
		- "OnAdvMapTileHint" был переименован в "OnAdventureMapTileHint". Предыдущее название устарело, но сохранено для совместимости.
		- Рефакторинг модуля внутренних настроек.
		- Диалог выбора IP больше не будет отображаться на экране настройки мультиплеера, если на ПК доступен только один IP-адрес.
		- Исправлено отслеживание команд ERM с ';' внутри строковых литералов (например, \^...;...\^).
		- Исправлено неточное определение местоположения и строки по адресу в модуле DebugMaps.
		- Исправлена карта отладки плагина buttons.dll (map-файл)
		- Устаревшее событие 'OnAbnormalGameLeave' больше не поддерживается. Способ HD мода вернуться с экрана боя в основное меню игры больше не поддерживается.
		- После события "OnGameLeave" выполнение ERM отключается. Триггеры MP3 и реального времени больше не выполняются вне основного цикла игры. Ранее триггеры выполнялись в контексте главного меню игры.
		- Исправлена ошибка, блокировавшая трэкинг ERM при вылете из игры;

#### Random Wallpaper Mod:
- Добавлена новая для всех меню;
- Заменён логотип в главном меню;
- Исправлены "пустые" картинки;
- Удалены .pac/.vid файла из-за ненадобности;

#### WoG:
- Исправлен баг опыта существ из прошлых обновлений;

#### WoG Scripts:
- Исправлена логика обновления банков существ;
- "Изменённые монстры": фикс скорости Архидьяволов;
- Улучшенные Военные Машины III: Исправлено лечение вражеских юнитов;

#### Other:
- Переименованы триггеры "OnAdvMapTileHint" на "OnAdventureMapTileHint";
- TrainerX/Enhanced Henchmen моды теперь тоже поддерживают мультиязычность;


### Версия 2.99

#### ERA Scripts:
- Исправлено затирание описания Вуали Тьмы;
- Временно отключена анимация появление "Ассасинов" из-за вылета во время битвы;

#### Enhanced Henchmen:
- Добавлена поддержка динамической смены языка;

#### TrainerX:
- Добавлена поддержка динамической смены языка;

#### WoG Scripts:
- Исправлено ​​восполнения банков существ;

### Версия 2.98

#### Other:
- восстановлены недостающие файлы; 

### Версия 2.97

#### ERA:
  - ВНИМАНИЕ! примеры использования всех нововведений находятся в файле /Help/Era manual/era iii Changelog.txt;

- обновление ядра ERA.dll до версии 3.9.13:
  - Улучшена устойчивость к исключениям для механизма ERM (триггеры и команды). Очистка памяти ERM выполняется в исключительных случаях, что позволяет повторно использовать механизм ERM позже после восстановления. Исключения могут использоваться, например, для быстрого выхода из глубоко вложенных диалогов.
  - Улучшена обработка сбоев/исключений. Обработчики HD и WoG вообще не вызываются. Обработчик Era вызывается только один раз. Отчеты о сбоях становятся более стабильными и точными. Раньше могло возникнуть несколько исключений, которые переопределяли одни и те же журналы.
  - Добавлена ​​экспериментальная (может быть удалена) экспортированная функция выхода из любого диалога в главном меню игры.
  - Командиры без флага UNDEAD теперь также обрабатываются Эликсиром Жизни. Плагины могут переопределять экспортированную функцию IsElixirOfLifeStack для реализации другого поведения.
  - В era.dll добавлены экспортированные функции, дополнительные шаги по переносу жестко закодированной механики WoG в заменяемый формат API. Установщики API возвращают ранее установленные функции реализации или ноль.
- Кнопка запуска диалога выбора языка теперь работает и в окне кампаний;

#### Advanced Classes Mod:
- Выстрел Артиллерии теперь не может атаковать свои войска, когда активной стороной является вражеская;
- В многопользовательских играх текст способностей наборов "Estate/Natural Healer/Secret" не будет отображаться для удаленного игрока.
- Исправлена проблема в многопользовательских играх, когда была возможность выбора заклинания вражеского командира (класс "Archmage/Warden") во время боя, что приводило к десинхронизации.
- Теперь немного сложнее получить высокие значения статистики для заклинаний "Молитва" и "Благословение".
- Различные исправления для многопользовательских игр.
- Заклинание "Dispel" теперь относится к воздушной магии, и в компенсацию "Disguised" перемещено в водную магию.
- Исправлено сообщение о бонусе набора "Разведка" перед боем.
- Исправлено: Огненный маг больше не пропускает бросок огненного шара после атаки, если он изучил умение "Strike all around".
- Исправлено: Магоги не наносили урон своим войскам, если они загипнотизированы.

#### Game Enhancement Mod:
- Заменена иконка мифрила на панели ресурсов @Grossmaestro;
- Удалена замена тумана войны;

#### Enhanced Henchmen:
- Исправлено неиспользование ИИ знамён полководца на оруженосцах;

#### TrainerX:
- удаление артефактов ранее не вызывало оригинальное событие снятия;
- Исправлено затирание имения артефакта "Зеркало" при открытии карты;
- Исправлено срабатывание открытия диалога дополнительных опций при нажатом "Ctrl";
- Исправлено некорректное удаление артефактов из структуры героя;

#### Random Wallpaper Mod:
- Переписан плагин логотипа; добавлена поддержка отрисовки поверх видео и управлением именем и положением картинки в обоих меню;

#### WoG Scripts:
- Артиллерия: исправлен стартовый выстрел баллисты. Теперь урон наносится согласно описанию на 100/200/300% от обычного урона отряда;
- Добавлена ​​поддержка восполнения новых банков существ;
- Исправлено возможное отключение опыта отрядов при переигровке боя.

#### Other:
- Добавлены файлы предпросмотра кампаний Клинка Армагеддона;
- В некоторых модах добавлена поддержка динамической смены языка
- Небольшие правки описаний;


### Версия 2.969

#### ERA:
- обновление ядра ERA.dll
	- уменьшена регенерация Эликсиром Жизни до 100 hp;
	- добавлена экспортируемая ф-ция SetStdRegenerationEffect для плагинов;
	
#### Random Wallpaper Mod:
- Исправлена невозможность выбрать размер карт в диалоге выбора сценария;


### Версия 2.968

#### ERA:
  - ВНИМАНИЕ! примеры использования всех нововведений находятся в файле /Help/Era manual/era iii Changelog.txt;

- обновление ядра ERA.dll до версии 3.9.12:
  - Реализованы расширенные средства синхронизации памяти ERM в сетевых играх.
  - Добавлена ​​команда !!IP:M для пометки ассоциативных переменных (SN:W, i^^, s^^) для дальнейшей синхронизации.
 Синтаксис:
 !!IP:M^имя_переменной_1^/^имя_переменной_2^/...;
 !!IP:M0/^array_var_name_1^/^array_var_name_2^/...;
  - Добавлена ​​команда !!IP:S для синхронизации всех отмеченных переменных и массивов. Используйте !!IP:D, чтобы указать цели для синхронизации.
  После его вызова кэш отмеченных переменных очищается.
  !!IP:S автоматически вызывается непосредственно перед отправкой сетевого события "начало боя" с помощью !!IP:D-1.
  - В Era Erm Framework добавлены константы GAME_TYPE_XXX (см. 5-й параметр UN:V).
  - В Era Erm Framework добавлены следующие глобальные переменные:
  i^battle_isActingSideUiUser^: bool. Имеет значение TRUE, если действующий побочный игрок является локальным человеком и, следовательно, может использовать все действия пользовательского интерфейса.
  Используйте его, чтобы запретить неактивному сетевому проигрывателю выполнять действия пользовательского интерфейса по изменению состояния.
  - В Era Erm Framework добавлены следующие функции:
  - !?FU(Array_Move);
  Копирует часть массива в другую часть массива, разумно перезаписывая существующие значения.
  - !?FU(Array_Splice);
  Удаляет указанное количество элементов из начального индекса и впоследствии вставляет новые элементы в ту же позицию.
  - !?FU(ActivateNextStack);
  Находит и активирует следующий стек. Возвращает TRUE в случае успеха и FALSE, если никто не может двигаться на этом этапе.
  - Реализована возможность выбора желаемого IP для многопользовательской игры.
  Игра  использует первый найденный IP-адрес ПК, при этом ПК может принадлежать нескольким сетям: LAN, WLAN, Virtual LAN, Интернет (белый IP-адрес).
  - В era.dll добавлены следующие экспортированные функции:
	- Выделяет новый идентификатор функции и привязывает его к указанному имени, если имя свободно, в противном случае возвращает уже связанный идентификатор.
	Эту функцию можно использовать для реализации пользовательских событий ERM в плагинах.
	Результатом будет 1, если был выделен новый идентификатор, и 0 в противном случае.
	функция AllocErmFunc (FuncName: pchar; {i} out FuncId: целое число): TDwordBool; stdcall;
	typedef bool (__stdcall* TAllocErmFunc) (const char* EventName, int32_t &EventId);

  — Добавлено новое событие для плагинов/Lua: "OnAfterReloadLanguageData". Это происходит всякий раз, когда Era перезагружает все языковые данные JSON с диска.
  - Переписана поддержка способности регенерации существ.
  (!) Плагины не должны перехватывать код регенерации и вместо этого должны использовать API Era 'SetRegenerationAbility'.
  — Экспортирована функция SetRegenerationAbility в era.dll только для плагинов (например, для новых плагинов существ).
  — Удалена опция "FixGetHostByName" в файле Heroes3.ini.
  - Исправлена ​​ошибка: индексы локальных статических строковых массивов неправильно рассчитывались для неконстантных индексов в скриптах ERM 2, например. (arr[i]).
  - Исправлена ​​ошибка в VFS.dll, из-за которой ERA не работала на Wine. Параметр пустой маски для NtQueryDirectoryFile обрабатывался как '*'#0 вместо '*'.

#### Advanced Classes Mod:
- добавлены исправления сетевого кода, игра теперь требует ERA 3.9.12;
- Исправлено поведение невосприимчивости Мага Огня, если он был загипнотизирован.
- Переработана переработка Огненного Щита. Теперь вместо проверки идентификатора существа, чтобы узнать, должны ли они быть невосприимчивы к Огненному щиту, мы используем крючок, чтобы проверить, должны ли они быть. Это также не позволяет "Огненному щиту" визуально показывать наличие у цели иммунитета.
- Добавлен FU(ACM_GetCustomFireShieldMultiplier), вызываемый сторонними скриптами для определения дополнительного урона от Огненного щита, наносимого конкретными монстрами.
- Исправлена ​​совместимость MP таблицы заклинаний Архимага/Стража. Теперь вы не можете выбрать заклинание для своего противника.
Логика заклинаний командира (для Архимага и Стража) воссоздана.
- Теперь вы можете выбирать заклинание как в бою, так и вне его.
- Частично исправлена ​​поддержка MP - теперь в PvP бою смена типа заклинания командира будет отражаться на другую сторону.
- Маг огня: теперь их атака Огненного шара/Инферно игнорирует иммунитет к заклинаниям враждебного юнита, а также защищает свои юниты.
- Опыт паладина и грубое золото: исправлены многочисленные логические сбои.
- Опыт паладина: теперь максимальный бонус опыта от урона составляет 10 миллионов.
(со всеми бонусами. Значение может быть больше без переполнения, только для баланса)
- Добавлены константы класса командира (для удобства настоятельно рекомендуется добавить новый .erm со всеми константами ACM)
- Сброс купленных заклинаний при покупке командира в городе.
- Исправлен ИИ, не использующий заклинания вызова элементалей.
- Добавлены новые названия классов для искателей приключений каждой фракции.
- Исправлена ​​ошибка скрипта командира "Удар со всех сторон".
- Исправлено обновление экрана при надевании второго одноименного артефакта

#### ERA Scripts:
- "Гноллы-мародёры бьют первыми": исправлено наложение Огненной Стены Пожарами, если их убивали Гноллы;
- Смертные герои: исправлена ​​функция переноса кампании.

#### Game Enhancement Mod:
- переписан плагин и скрипт получения локальной и удалённой версии. Для получения локальной версии теперь используется ф-ция, возвращающая строковое значение: "!!FU(gem_GetGameVersion):P?(gameVersion:z);";
- добавлена проверка на наличие сохранённых настроек ВоГ-опций и предупреждение о необходимости сохранить, если они отсутствуют;
- Добавлен ArchBugFixes.era [исходники](https://github.com/Archer30/Era-Plugins/tree/main/ArchBugFixes);
- Обновлена ​​prima.dll: исправлена ​​ошибка, из-за которой очки заклинаний не удваивались при посещении Вихря Маны, когда у героя было >127 знаний.

#### Enhanced Henchmen:
- Исправлена ​​функция переноса кампании.

#### Random Wallpaper Mod:
- переписан плагин добавления логотипа для исправления вылета при попытке открыть окно загрузки игры;

#### TrainerX:
- добавлено корректное открытие карты после увеличения радиуса видимости героя;

#### WoG:
- Добавлен плагин "ERA_MultilingualSupport.era", позволяющий менять язык загруженных ресурсов из Lang/.\*json при наличии локализации. Список и параметры локализаций указывается в файле /Mods/WoG/Lang/era.json;

#### WoG Scripts:
- Нейтральный город: фиксированные элементальные существа не могут быть улучшены в крепостях на холмах. Исправлена ​​опция нейтрального города, отключающая опцию Rampart Faerie Dragon.
- Добавлено исправление, предотвращающее появление случайных монстров на карте.
- Исправлено неправильное отображение внешних жилищ, дающее дополнительный рост существам в городе.

#### Other:
- добавлен недостающий файл /Tools/H3DefTool/Grid.pcx для запуска H3DefTool;
- добавлен недостающий файл h3wmaped_unleashed.exe для запуска расширенного редактора карт;
- добавлен мануал по отключению DEP (Help/DEP_tutorial.html);
- удалены лишние файлы инструментов;

### Версия 2.967

#### Advanced Classes Mod:
- Призыв элементаля: Теперь мы используем нативный способ призыва элементаля, исправили тень на поле боя, значок книги заклинаний и, возможно, другие проблемы.
- Исправлена ошибка, из-за которой **ГМ Зыбучие пески** мешал подсветке.
- Классы командиров теперь защищен от повторного воспроизведения.
- Теперь количество убийств добавляется только после убийства (а не до него). Это также исправляет ситуации, когда убийство не считается действительным, например, из-за блокирующих или отражающих способностей атакующего юнита, которые могут предотвратить убийство, или если атакующий юнит умирает в процессе (например, от ожогов от **Огненного Щита**).
- Исправлена ошибка, из-за которой **Стойкий Часовой** не давал 10% сопротивления, как указано в описании.
- Некоторые изменения формата.
- Теперь мы используем хук вместо воспроизведения **UN:C** в нужное время, чтобы охватить все в игре и упростить наш код.
- Это исправило проблему с неправильным отображением количества очков заклинаний в бою ([ссылка](https://discord.com/channels/580473641104310301/580473641104310305/1238718760123109407)).
- Исправлена неправильная проверка условия для 8-го существа **TUM**.
- Исправлена невозможность воскрешения **Привидений**.
- Исправление и балансировка **Фортуна**.
- **ГМ Фортуна** теперь:
	- крадет 2 скорости, 3 урона, 4 атаки или 4 защиты при атаке (немного меньше, чем ранее);
	- уважает иммунитет к заклинаниям (черные драконы по умолчанию не могут быть украдены);
	- минимальная скорость теперь 2;
	- если недостаточно характеристик для кражи, в журнале боя отображается точное украденное значение.
- Небольшая коррекция отображения восстановления очков заклинаний.
- Улучшения секретного класса.
- Исправлена дублированная опция в "Выборе класса" (в начале игры). Теперь одна из них задает вопрос после 2 уровней.
- Исправлено обнаружение набора артефактов. Теперь экипировка двух артефактов с одинаковым названием не уменьшает количество частей набора.
- Максимальное количество убийств для **Командиров** теперь 9999 (визуальное изменение).
- Теперь ИИ также может улучшать характеристики своего набора класса с каждой победой (если ему удается украсть его у человека). Они не выпадают сами из-за условия &1000.

### Game Enhancement Mod:
- Исправлена ошибка с первым действующим юнитом, когда скорость двух стеков одинакова;
- Переписана функция GetTime;
- Обновлена функция проверки версии;

#### WoG (Wake of Gods):
- Добавлен список локализаций для будущего диалога смены языка;

#### WoG Scripts:
- Убрано исправление ошибки атаки в ближнем бою для военных машин, так как оно уже представлена в плагине;
- Улучшенные Боевые машины III: Исправлена возможность лечения враждебных стеков;
- Рыболовный колодец: исправлено небольшое сообщение инициализации;


### Версия 2.966

#### Advanced Difficulties Mod:
- Теперь способности по набору опыта для дальнобойных существ больше не будут применяться к ближнему бою.
- Уменьшена скорость накопления стражей для крестьянских банков TUM.
- Добавлена проверка, чтобы предотвратить выполнение ошибочного значения.
- Нейтральные сложности: теперь при нажатии на кнопку сброса также будет отключаться смешанный нейтральный режим, если он был включен.

#### Advanced Classes Mod:
- Исправлена возможная ошибка erm с некромантией;
- Когда включен Орлиный Взгляд I (заклинание обучения при повышении уровня), оно будет удалено, если в будущем нельзя будет изучить заклинание. Теперь, если включен ACM, эта механика не будет активирована.
- Диалог улучшения Боевой Машины: исправлена интеракция при нажатии на кнопку улучшения без выбора улучшения
- Усиление заклинания "Минное поле" с помощью следующих изменений:
	- Теперь заклинание можно использовать, если на стопке противника есть местные существа территории
	- Местные существа территории будут видеть минное поле как обычно, но получат урон от мин (это изменение должно быть пересмотрено после последних тестов)
	- Улучшена способность Арканного Пророка (теперь увеличение урона показывается при начале боя и не выбирается случайным образом перед каждым использованием. Увеличение урона непосредственно видно в книге заклинаний). Обновлено описание артефактов артефактов SP Reg.
	- Преимущество концентрации друидов теперь работает с повтором битвы.
	- Умение лорда или грабеж города теперь имеет перезарядку 2 недели для каждого города.
	- Исправлено имя умения Мастер Воин. Гибридные классы теперь получают такое же количество критических попаданий, как и Мастер Воин.
	- Пассивная способность командира грубиянов теперь также работает для защищающегося героя.
	- Исправление длительности гипноза благодаря SadnessPower
- Улучшено взаимодействие мыши при нажатии на значок удачи на экране героя
- Улучшено взаимодействие мыши (включить или выключить стандартное действие или когда отключить и т. Д.)
- Исправлено имя секретного класса, которое может быть раскрыто до его разблокировки.
- Экспорт некоторого текста в erm в json
- Удалено неиспользуемое содержимое таблицы искусства TUM
- Баланс класса Снайпер. Теперь ХП как урон составляет 7% + 1% за каждые 7 убийств (как обсуждалось). Максимальное значение достигается при 50%. Для боссовых существ (MA:P >= 5000) максимальное значение уменьшается вдвое (25%).
- Теперь режим 10 навыков включается автоматически, когда в игре можно получить более 10 навыков, даже если 10ss или другой плагин, увеличивающий лимит навыков, включен после начала игры.
- Расширена область кликабельности acmlist.txt - информация о продвинутом классе командира повышена, чтобы ее было удобнее нажимать.
- Поставьте знак "+" перед статическим бонусом скорости в acmlist.txt. Так мне будет легче понять.
- ACM - горячие клавиши на экране героя:
	- Нажмите A - текущий продвинутый класс
	- Нажмите W - информация о продвинутых классах
	- Нажмите E - таблица бонусов
	- Нажмите R - таблица тренера заклинаний (если включено)
- Исправлено, что Альтернативная Некромантия позволяет выбирать существа более высокого уровня для воскрешения, даже если уровень Некромантии не соответствует требованиям.
- ACM Усадьбы отображаются в Обзоре Королевства;
- Больше не отключают Альтернативную Некромантию по умолчанию при включении TUM, так как они теперь совместимы.
- Разведка: теперь она поддерживает расширенных монстров. В случайных событиях разрешается только монстры со статусом < уровня 8.
- Дворянство: теперь оно поддерживает 8-го уровня существ (TUM);
- Исправлены очки заклинаний не x10 при призыве элементалей на карте в развитом режиме;
- Пересозданы специалисты по существам. Теперь оно работает стандартным образом, показывает бонусы в диалоговом окне существ, когда не в бою. Работает и для Игниссы.
- Пересоздано правой кнопкой мыши для деталей усовершенствования боевых машин из экрана героя/экрана встречи героя. Теперь функция поддерживает экран встречи героя.
- Исправлена критическая проблема: когда вы проверяете информацию о существе вне боя, иногда отображается информация о командирах (ACM_beforeCreatureInfoDlg_Show).
- Добавлены иконки UN32 для новых специальностей
- Исправлены все взаимодействия с мышью на иконках специализации героя. Теперь левый клик мыши вызовет обычное диалоговое сообщение вместо всплывающего, как и должно быть.
- Отключить бесполезное взаимодействие мыши при установке имен из набора искусства ACM DL. Планируется добавить описание набора, когда нажимается на имена наборов, но управление русским языком не так просто.
- Исправлено умение Лорда Хаарта: иконка и текст
- Пассивная способность командира паладинов теперь работает для защитника
- Заклинания, выученные с помощью Интуиции, будут сброшены в случае Повтора Битвы
- ACM - Отключить функцию рюкзака ACM, исправить совместимость с описанием заклинаний;
- Отключить функцию артефактов рюкзака ACM, освободить артефакты ERA Scripts из запрета, так как опция ES работает немного лучше и, кажется, более приветствуется (поскольку она также работает для артефактов, увеличивающих очки хода).
- Отпустить Гейт Кей из запрета. Теперь его можно использовать для блокировки вашего города, как в WoG. Эффект будет изменен в будущем, когда у нас появятся новые идеи.
- Исправлена совместимость с описанием заклинаний. Теперь неверный текст из книги заклинаний отключен.
- Пассивное умение "Командир - удар со всех сторон" теперь не показывает -10% бонуса к атаке в таблице бонусов ACM
- Добавлено условие безопасности для скрипта "Командир - удар со всех сторон" для вторичных целей.
"; Этот скрипт не будет работать, если атакующий, защищающийся и вторичные цели находятся на одной стороне (возможно с Берсерком)
; Чтобы решить эту проблему, нам нужно ввести новый хук, чтобы получить фактический атакующий стек. Но это редкая ситуация, поэтому мы пока не делаем этого"
- Исправлено взаимодействие мыши с иконкой очков заклинаний (для LMB действие мыши должно быть 12, а не 13)
- Переработаны все добавления очков хода. Теперь вам не нужно беспокоиться о том, что максимальное количество очков хода изменится после открытия экрана героя. Исправлено то, что Умение "Мастер Путь" не дает вам по крайней мере 1700 очков хода каждый ход. Исправлено то, что Мастер/Великий Мастер Логистики не работают с Логистической специальностью.
- Пересмотрено отображение специализаций существ. Теперь все бонусные статистики, включая местные, отображаются в описании специализации существа.
- Исправлено, что Анциент не получает +4% после 100 убийств
- Исправлена утечка памяти для описания Боевых Машин на поле боя
- Переработан эффект стока. Теперь он должен работать точно так же, как и стандартный механизм Вампиризма. Скажите мне, если что-то отличается

#### Enhanced Henchmen:
- Исправлено невозможность изменения помощников, когда в армии героя находится только одно существо;
- Исправлен текст "Отмена";

#### ERA ERM Framework:
- FU(UpdateNextStackTurn) будет выполнен один раз в !?FU(OnBattleRound_Quit)&i^battle_round^=0, чтобы убедиться, что порядок ходов не нарушен скриптами.

#### ERA Scripts:
- Исправлены неограниченные призывы скелетов из опции Артефактов Скелета;
- Исправлено падение игры при жертвоприношении Дьявола
- 28 Вторичных Навыков: Улучшена совместимость с плагинами, изменяющими количество вторичных навыков.
- Дальнобойный Смертельный Взгляд: Теперь навык не работает на командиров и существ 8 уровня (несмотря на то, что существа 8 уровня могут подвергаться действию ближнего смертельного взгляда). Исправлены ошибки erm. Оптимизированы подсказки мыши. Исправлены ошибки erm. FU(ES_995_CheckIfStackAffectedByDeathStare) может использоваться скриптерами, чтобы исключить свой стек из действия дальнобойного смертельного взгляда.
- Ночная Разведка: Исправлено, что Ассасины не появляются.

#### Game Enhancements Mod:
- исправлен редкий вылет в битве;
- Обновление "Game Bug Fixes Extended":
	- Исправлена тень курсора силового поля для защищающегося игрока;
	- Исправлено возможное застревание, когда ИИ воскрешает убитый стек;
- Изменено исправление переполнения значения ИИ от деления значения ИИ существ на 15 до 10. Это смягчает проблему того, что ИИ становится намного менее агрессивным после деления.
- Пересоздан призыв Драконьего Сердца так, как это было изначально, так как в оригинале можно вызвать драконов, перекрывающих другие юниты ([Обсуждение](http://wforum.heroes35.net/showthread.php?tid=4218&pid=138936#pid138936))
- Добавлено общее исправление, чтобы в новый день максимальные и текущие очки хода были равны для каждого героя - это помогает предотвратить некоторые особенности WoG и сценарии, мешающие этому;

#### Secondary Skills Scrolling:
- Исправлена неработающая кнопка тактики, когда навык "тактика" не находится на текущей странице навыков героя;

#### TrainerX:
- Теперь отключение/включение событий, строительство/разрушение городских зданий все равно будет работать, когда событие/город находится под нажатием героя.
- Добавлен обратный режим бога, активируемый щелчком на портрет героя в основном интерфейсе тренера с зажатой клавишей Shift, по сути, все установить на минимум.
- Исправлены некоторые ошибки в функции Отображения Событий
Примечание: Поскольку теперь Отображение Событий зависит от хука erm для работы, загрузка TrainerX во время игры с помощью F12 требует одного дополнительного шага: сохранение игры и загрузка.
- Улучшена возможность TrainerX загружаться после начала игры. Теперь вам не нужно нажимать F12 + Сохранить и Загрузить (достаточно только F12), когда загружаете TrainerX после начала игры
- Исправлена возможная ошибка erm при проверке экрана героя из основного диалогового окна TrainerX.
- Режим бога теперь может использоваться, когда нет героя для изменения видов карты и ресурсов.

#### WOG:
- Исправлено жилище Обители Эфритов и Повелителей Ям в zlagport.def

#### WoG Fix Lite:
- обновлено до версии 2.17;
- [Исправлен спрайт Священного Феникса](https://discord.com/channels/665742159307341827/741855494276382801/1232159404359680041)

#### WoG Scripts:
- Теперь Рынок Времени на карте Титановой Зимы работает правильно;
- Оптимизирована совместимость с Искусством Войны;
 - Изумрудная Башня: Добавлено Живое усиление;
 - Мифрил: Теперь эффекты мифрилового усиления на Ветряные Мельницы/Водяные Колеса являются постоянными (как в WoG 3.58f. Не уверен, почему это было изменено. Стоимость улучшения более разумная для постоянного улучшения);
- Взаимоотношения Существ: Исправлено, что тип существа исказился после конфликта;
- Исправлено, что Война не устанавливает все навыки сразу;
- Улучшенные Монстры: Исправлено, что Дьяволы могли получать бесплатную скорость с активированными фазами тактики в бою
- Улучшенные Артефакты I: Теперь сообщение о Подвеске Второго Зрения, Подвеске Свободной Воли и Накидка Сопротивления будет показано только в случае активации их эффектов. Исправлена невозможность обмена Гарнитуры Мешающего на магический навык по понедельникам.
- Теперь все сценарии замены монстров/артефактов игнорируют настраиваемые нейтральные стеки и артефакты на карте.
- Первая Помощь I: Предотвращен эффект от воскрешения существ, когда исходные войска полностью уничтожены.
- Оруженосцы: Небольшая оптимизация выбора Оруженосца ИИ
- Изумрудная Башня: Исправлены имена существ после усиления.
- Изумрудная Башня: Уточнение информации, когда у игрока недостаточно для оплаты.
- Алтарь Трансформации: Исправлено, что нейтральные существа не могут быть преобразованы.
- Изумрудная Башни: Теперь ИИ больше не будет улучшать Нежить или Живые существа, так как они не могут использовать их должным образом.
- Исправлено запрещение заклинаний от Ученых: Теперь заклинания, отключенные с карты (вместо из настроек wog), не будут запускать сценарий запрещения заклинаний от Ученых.
- Исправлена подсказка поддержки горячего кресла для Улучшенных Боевых Машин III
- Изумрудная Башня: Исправлено отображение двойных диалогов при возврате платы за запись (6 камней).


### Версия 2.965

#### Game Enhancements Mod:
- восстановлена кнопка завершения хода;

#### WoG Scripts:
- Исправлена замена запрещенных заклинаний у ученых;
- Перенесено знамя полководца от оруженосца в рюкзак героя после его смерти - спасибо Archer30;
- Небольшие исправления текста;

### Версия 2.964

#### ERA ERM Framework:
- добавлены константы о типах квестов и наградах;
- добавлена функция обновления всех квестов на карте (не влияет на пользовательский текст);

#### Game Enhancements Mod:
- добавлено смещение 8 пикселей для отрисовки пользовательских диалогов рядом с границами окна игры;;
- убрано создание лишних pcx;

#### WoG Scripts:
- Исправлено описание "Артефактов Дипломатии" при включении Улучшенных Артефактов I/II и "Дипломатических Торгов" - спасибо Archer30;
- Улучшенные командиры: перемещено место для выхода из хука (хотя для командира разницы не будет) - спасибо Archer30;
- Исправлено убийство нейтралов со случайными героями, не позволяющее выполнить соответствующий квест в хижине провидца - спасибо Archer30;
- "Живые свитки" и "Усиленные специализации героя": удалены автоматические применения на обездвиженные вражеские отряды;

#### ERA Scripts:
- Захват мельниц и садов: добавлена проверка координат, так как был отчет о неверных координатах - спасибо Archer30;

#### TrainerX:
- Теперь удаление существ или героев на карте также завершает соответствующий квест в хижине провидца - спасибо Archer30;

### Версия 2.963

#### Game Enhancements Mod:
- Исправлено перемешивание юнитов в замках (в крепости и сопряжении были копейщики);

#### WoG Scripts:
- Новые боевые поля: исправлены нерабочие поля - спасибо Yuritsuki;

#### ERA scripts:
- Захват боевых машин: исправлен вылет при захвате иных артефактов;
- Ночная разведка: исправлен нерабочий переключатель ассасинов;

### Версия 2.962

#### Game Enhancements Mod:
- Убраны хардкорные правки памяти;

#### WoG Scripts:
- Искусство войны: исправлен сбой, когда ИИ пытается получить один из навыков Искусства войны;

#### ERA scripts:
- Подавление стихий: исправлена возможность потери магических навыков после боя - спасибо Archer30;
- Захват боевых машин: исправлено исчезновение захваченных боевых машин;
- Удалены неиспользуемые скрипты и текст для Capture War Machines - спасибо Archer30;
 
### Версия 2.961

#### Game Enhancements Mod:
- Добавлено несколько скриптов для 1 апреля;
- Форты на холмах - стоимость улучшения рассчитывается на основе уровня улучшенного монстра, а не уровня текущего монстра - благодаря Archer30;
- Исправлен скрипт ограничения максимального уровня героя - спасибо Archer30;
- Оптимизирован гибкий ввод читов. Теперь пробел перед первым словом будет игнорироваться — благодаря Archer30.

#### WoG Scripts:
- Улучшенные артефакты II: Исправлено Кольцо Мага и его компоненты, которые могут не работать для увеличения урона от заклинаний - благодаря Archer30.

#### Advanced Classes Mod:
- Исправлена возможность изучения заклинаний из Артефактов с помощью GM Scholar - благодаря Archer30;
- Добавлен фикс для будущего TUM Full - спасибо Archer30;
- Обновлена графика Волшебной Палочки для совместимости с TUM - благодаря Archer30;
- Обновлена локализация - Большое спасибо DrD_AVEL_;
- Исправлено снижение уровня некромантии, работающее только для атакующего героя.
- Исправлена альтернативная некромантия, устанавливающая скорость некромантии вместо ее ограничения - благодаря Archer30;
- Грааль в Некрополисе вновь дает 20% бонус к Некромантии (вместо 10%) - благодаря Archer30;
- Исправлен текст Усилителя Некромантии (он дает бонус 5% вместо 10%) - спасибо Archer30;
- Оптимизирован диалог Альтернативной Некромантии. Теперь игра запоминает последний выбор героя. По умолчанию показано настоящее существо, которое нужно поднять (вместо скелетов) — благодаря Archer30;

### Версия 2.96

#### ERA:
- Обновлена до версии 3.9.11 - спасибо Berserker;
- Обновлен плагин "game bug fixes extended.dll" - спасибо igrik;

#### HD mod:
- Обновлен до версии 5.4 R86 - спасибо baratorch;

#### ERA ERM Framework:
- Добавлена инициализация i^battle_round_^ при переигровке битвы - спасибо Archer30.

#### Game Enhancements Mod:
- Добавлена функция гибких читов. Теперь поддерживаются все чит-коды от RoE/AB/SoD. Если чит-код введен с другой несвязанной информацией, он также будет распознан и применен — спасибо Archer30.
- Улучшено исправление для гильдий магов в восстановленных городах (после сноса): теперь в гильдиях будут появляться заклинания высокого уровня. Добавлена поддержка исследования заклинаний - спасибо Archer30.

#### WoG Scripts:
- Новые банки существ: теперь, когда охранники "Потерянных бутылок" побеждены, героя спросят, стоит ли забрать бутылку. Если взять бутылку, герой может прочитать случайное сообщение внутри, и бутылка навсегда исчезнет с карты — спасибо Archer30.

#### ERA Scripts:
- Пользовательские основные навыки: исправлена возможность распределения Первичных Параметров при повышении уровня - спасибо Archer30.

#### Advanced Classes Mod:
- Исправлена возможность изучения заклинаний из Артефактов с помощью GM Scholar - спасибо Archer30.
- Добавлено исправление для будущего TUM Full - спасибо Archer30.
- Обновлена графика Волшебной Палочки для совместимости с TUM - спасибо Archer30
- Обновлена локализация - спасибо PerryR;

#### Advanced Difficulties Mod:
- Заменен значок основных навыков на оригинальный стиль H3 (был в WoG) - спасибо Archer30.

#### TrainerX:
- Добавлен режим Бога. Щелкните Alt-клик по портрету героя, чтобы максимально использовать Армию/Движение/Ману/Полет/Основные навыки/Вторичные навыки/Заклинания/Видение карты/Ресурсы - спасибо Archer30
- Добавлен щелчок с нажатой клавишей Ctrl/Alt/Shift по названию вторичных навыков, чтобы управлять всеми вторичными навыками одновременно – спасибо Archer30.
- Исправлена ошибка, из-за которой прокрутка основных навыков не работала правильно, когда статистика превышает 127 - спасибо Archer30.
- Теперь открытие экрана героя из трейнера позволит редактировать любые данные героя (а не только просмотр) - спасибо Archer30;
